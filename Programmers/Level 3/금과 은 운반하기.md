
# 📚 금과 은 운반하기

## 📌 [문제링크](https://school.programmers.co.kr/learn/courses/30/lessons/86053)

### 문제 해설

- 왕국에 여러 개의 도시가 있고, 왕은 새 도시를 지으려고 한다. 새 도시를 짓기 위해서는 일정량의 금 a 와 은 b가 필요한데, 왕은 해당 광물들을 기존의 도시들에   
각각 트럭을 한 개씩 배치하여 수송하여 옮기려고 한다. 각각의 도시들에 남은 금과 은의 양과 각각의 트럭들이 시간당 옮길 수 있는 광물의 양은 제각각 다르다.  
이 때 새 도시를 짓기위해서 금 a(kg)과 은 b(kg)를 모두 옮기는데 걸리는 최소 시간을 구하는 문제이다.

### 문제 풀이

- 파라메트릭 서치가 사용된다.
- 파라메트릭 서치는 매개변수를 이용한 탐색 기법이며 최적화된 답을 구하기 위해 결정 알고리즘을 사용한다. 결정 알고리즘으로 이진 탐색을 사용한다.
- 문제를 보면 조건의 크기(새 도시에서 요구하는 금과 은의 양, 기존 도시에서 옮길 수 있는 금과 은의 길이, 도시 개수)가 매우 크다.  
조건의 크기가 너무 크기 때문에 선형탐색으로는 어렵고, 이진 탐색으로 접근하는 문제라는 생각이 들었다. 각각의 시간에 기존 도시에서 새 도시로 옮길 수 있는  금과 은의 양을 계산해서 광물의 양이 조건을 만족하냐 불만족하냐에 따라 탐색 범위를 나누었다.  
1. 어떤 시간에 새 도시에서 요구하는 광물의 양을 모두 옮길 수 있다면 앞 시간을 탐색한다.  
뒤의 시간은 당연히 모든 광물을 옮길 수 있지만 문제가 요구하는 것은 최소시간이다. 따라서 뒷 시간을 탐색하는 것은 무의미한 탐색이기 때문이다.  
2. 어떤 시간에 새 도시에서 요구하는 광물의 양을 모두 옮길 수 없다면 뒷 시간을 탐색한다.
현재 시간에 모든 광물을 옮길 수 없다면 더 빠른 시간에는 당연히 시간이 더 모자르기 때문에 모든 광물을 옮길 수 없다. 따라서 앞 시간을 탐색하는 것은 무의미한 탐색이다.

- 위와 같이 특정 시간에 새 도시로 모두 옮길지를 계산하여 최적화 된 답을 도출한다. 그럼 기존 도시가 새 도시로 광물을 모두 옮길 수 있을지 어떻게 계산할까?

#### 아이디어 1 (수학적 풀이)

풀이를 하기전에 문자를 정리하겠다.
특정 시간에 도시에서 옮길 수 있는 금,은의 양을 G,S라 하면
Gmax => 해당 시간에 옮길 수 있는 최대한의 금의 양. => 금을 우선시해서 욺길 경우에 금의 양. 
Gmin => 해당 시간에 옮길 수 있는 최소한의 금의 양. => 은을 우선시해서 은을 다 옮기고 나서 옮긴 금의 양 
Smax => 해당 시간에 옮길 수 있는 최대한의 은의 양. => 은을 우선시해서 옮길 경우에 은의 양
Smin => 해당 시간에 옮길 수 있는 최소한의 은의 양. => 금을 우선시해서 금을 다 옮기고 나서 옮긴 은의 양
Gx => 새 도시에서 요구하는 금의 양
Gy => 새 도시에서 요구하는 은의 양

특정 시간에 마을에서 옮길 수 있는 금의 범위는 Gmin ~ Gmax 이고 은의 범위는 Smin ~ Smax 이다.

그럼 Gx,Gy가 저 위에 범위에 포함되기만 하면 될까? 답은 아니다.

위의 답을 내리기 전에 한가지 정리 할 것이 있다. 광물의 총량과 관련된 공식이다.

만약 특정시간에 도시에서 광물에서 200kg을 옮길 수 있다. 가진 금과 은의 합이 200kg 이하인 경우 금과 은중에 어느것을 우선적으로 해도 둘 다 옮길 수 있을까?  
당연히 둘 다 옮길 수 있다. 총 광물의 양이 200kg보다 적으니 어떤 광물을 옮겨도 결국 다 옮기게 될테니까 말이다.  
광물의 양(200kg이하) = Gmax + Smin = Gmin + Smax 이다. 또한 Gmax = Gmin 이고 Smax = Smin 인걸 알 수 있다.

그럼 가진 금과 은의 양이 해당 시간내에 다 옮기지 못할 정도로 많으면 어떨까?
마찬가지로 광물의 양(200kg) = Gmax + Smin = Gmin + Smax 이다. 그러나 Gmax != Gmin 이고 Smax != Smin 이다.(다 옮기지 못하므로 어느걸 우선시하느냐에 따라 광물의 비율이 달라지기 떄문)  

따라서 최소한 Gmax + Smin = Gmin + Smax 는 무조건 성립한다. 결국 비율은 달라도 광물의 양은 고정이므로 확장해서 생각해보면 Gx + Sy 도 같다는 것을 알 수 있다. 

이제 위의 답을 하자면,
1. Gmin <= Gx <= Gmax
2. Smin <= Sy <= Smax
이 두 조건을 만족할 뿐만 아니라, 총합 광물의 양은 a+b보다 크거나 같아야 한다. 왜냐하면 위 조건만으로는 한쪽 광물의 양을 채워도 다른 광물의 양을 보장할 수 없기 때문이다.
도시에서 Gx를 만족시키더라도 이 때 옮길 수 있는 은의 양은 Total - Gx 이다. 은의 양은 Total의 값과 Gx의 값에 영향을 받는다. 문제에서 요구하는 금의 양을 충족하기 위해  
최소 Gx는 a부터 시작하기 때문에, 제일 작게 금의 값을 설정해도 나머지 Total의 값이 작으면 새 도시에서 요구하는 은의 양의 값을 만족시킬 수 없다.
따라서 Total - a >= b 가 필요한 조건이 된다.
정리하면,

- Gmax >= a and Smax >= b and Total >= a +b 가 이진탐색 탐색범위을 선택하는데 필요한 조건이다.


#### 아이디어 2 (기하학으로 상상하기)

자석 막대가 N극 S극으로 이루어져 있듯이, 한쪽에는 금극으로 이루어진 막대와 은극으로 이루어진 막대가 있다.
기존 도시에서 금을 우선으로 옮긴다. => 금극의 끝에서부터 특정길이까지 자른다. => 새 도시에서 요구하는   
기존 도시에서 은을 우선으로 옮긴다. => 은극의 끝에서부터 특정길이까지 자른다.  
도시에서 요구하는 금의 양,은의 양을 옮긴다. => 만약 기존도시에서 현재 시간에 광물을 150kg 옮길 수 있다 가정하자. 그러면 금 100kg, 은 50kg를 잘라낼 수 있는 빵틀처럼 생긴 틀을 가지고  
잘라낸다고 상상하자.

```
def solution(a, b, g, s, w, t):
    answer = int(1e5 * 4 * 1e9)
    
    left = 0
    right = int(1e5 * 4 * 1e9)
    
    while left <= right:
        mid = (left + right) // 2
        gold = 0
        silver = 0
        total = 0
        for i in range(len(g)):
            movement_count = mid // (t[i] * 2)
            if mid % (t[i] * 2) >= t[i]: # 편도로 갈 여분이 있다면
                movement_count += 1
            city_gold = w[i] * movement_count if w[i] * movement_count <= g[i] else g[i] # GMax
            city_silver = w[i] * movement_count if w[i] * movement_count <= s[i] else s[i] # SMax
            gold += city_gold
            silver += city_silver
            total += w[i] * movement_count if s[i] + g[i] >= w[i] * movement_count else s[i] + g[i]
            
        if gold >= a and silver >= b and total >= a + b:
            right = mid - 1
        else:
            left = mid + 1
    return left             # left : 0 400000000000001 right  : -1 400000000000000
```
